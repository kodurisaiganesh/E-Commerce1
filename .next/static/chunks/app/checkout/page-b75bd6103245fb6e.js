(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{4014:function(e,t,r){Promise.resolve().then(r.bind(r,7982))},7982:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return N}});var s=r(9268),n=r(6304),a=r(5579),o=r(9005),i=r(8050),c=r(1712);let l=async e=>{try{let t=await fetch("/api/stripe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c.Z.get("token"))},body:JSON.stringify(e)}),r=await t.json();return r}catch(e){console.log(e)}};var d="https://js.stripe.com/v3",u=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,p=function(){for(var e=document.querySelectorAll('script[src^="'.concat(d,'"]')),t=0;t<e.length;t++){var r=e[t];if(u.test(r.src))return r}return null},m=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(d).concat(t);var s=document.head||document.body;if(!s)throw Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(r),r},h=function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"1.54.1",startTime:t})},f=null,g=function(e,t,r){if(null===e)return null;var s=e.apply(void 0,t);return h(s,r),s},x=Promise.resolve().then(function(){return null!==f?f:f=new Promise(function(e,t){if("undefined"==typeof window||"undefined"==typeof document){e(null);return}if(window.Stripe,window.Stripe){e(window.Stripe);return}try{var r=p();r||(r=m(null)),r.addEventListener("load",function(){window.Stripe?e(window.Stripe):t(Error("Stripe.js not available"))}),r.addEventListener("error",function(){t(Error("Failed to load Stripe.js"))})}catch(e){t(e);return}})}),y=!1;x.catch(function(e){y||console.warn(e)});var j=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];y=!0;var s=Date.now();return x.then(function(e){return g(e,t,s)})},w=r(6008),b=r(6006),v=r(2120),S=r(474);function N(){let{cartItems:e,user:t,addresses:r,setAddresses:c,checkoutFormData:d,setCheckoutFormData:u}=(0,b.useContext)(a.GlobalContext),[p,m]=(0,b.useState)(null),[h,f]=(0,b.useState)(!1),[g,x]=(0,b.useState)(!1),y=(0,w.useRouter)(),N=(0,w.useSearchParams)(),k=j("pk_test_51OP3qiSAp8MZGresQ8ibRhmRo3I4AroTXJvAVSwQEFp9GVTh80yAChvVH9ckL1LuNBr1yT78pOxb65GCF0DvFTxG002WKo24i2");async function A(){let e=await (0,o.ar)(null==t?void 0:t._id);e.success&&c(e.data)}async function C(){let t=await k,r=e.map(e=>({price_data:{currency:"usd",product_data:{images:[e.productID.imageUrl],name:e.productID.name},unit_amount:100*e.productID.price},quantity:1})),s=await l(r);f(!0),localStorage.setItem("stripe",!0),localStorage.setItem("checkoutFormData",JSON.stringify(d));let{error:n}=await t.redirectToCheckout({sessionId:s.id});console.log(n)}return console.log(e),(0,b.useEffect)(()=>{null!==t&&A()},[t]),(0,b.useEffect)(()=>{(async function(){let r=JSON.parse(localStorage.getItem("stripe"));if(r&&"success"===N.get("status")&&e&&e.length>0){f(!0);let r=JSON.parse(localStorage.getItem("checkoutFormData")),s={user:null==t?void 0:t._id,shippingAddress:r.shippingAddress,orderItems:e.map(e=>({qty:1,product:e.productID})),paymentMethod:"Stripe",totalPrice:e.reduce((e,t)=>t.productID.price+e,0),isPaid:!0,isProcessing:!0,paidAt:new Date},n=await (0,i.mg)(s);n.success?(f(!1),x(!0),S.Am.success(n.message,{position:S.Am.POSITION.TOP_RIGHT})):(f(!1),x(!1),S.Am.error(n.message,{position:S.Am.POSITION.TOP_RIGHT}))}})()},[N.get("status"),e]),(console.log(d),(0,b.useEffect)(()=>{g&&setTimeout(()=>{y.push("/orders")},[2e3])},[g]),g)?(0,s.jsx)("section",{className:"h-screen bg-gray-200",children:(0,s.jsx)("div",{className:"mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsx)("div",{className:"mx-auto mt-8 max-w-screen-xl px-4 sm:px-6 lg:px-8 ",children:(0,s.jsx)("div",{className:"bg-white shadow",children:(0,s.jsx)("div",{className:"px-4 py-6 sm:px-8 sm:py-10 flex flex-col gap-5",children:(0,s.jsx)("h1",{className:"font-bold text-lg",children:"Your payment is successfull and you will be redirected to orders page in 2 seconds !"})})})})})}):h?(0,s.jsx)("div",{className:"w-full min-h-screen flex justify-center items-center",children:(0,s.jsx)(v.Z,{color:"#000000",loading:h,size:30,"data-testid":"loader"})}):(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"grid sm:px-10 lg:grid-cols-2 lg:px-20 xl:px-32",children:[(0,s.jsxs)("div",{className:"px-4 pt-8",children:[(0,s.jsx)("p",{className:"font-medium text-xl",children:"Cart Summary"}),(0,s.jsx)("div",{className:"mt-8 space-y-3 rounded-lg border bg-white px-2 py-4 sm:px-5",children:e&&e.length?e.map(e=>(0,s.jsxs)("div",{className:"flex flex-col rounded-lg bg-white sm:flex-row",children:[(0,s.jsx)("img",{src:e&&e.productID&&e.productID.imageUrl,alt:"Cart Item",className:"m-2 h-24 w-28 rounded-md border object-cover object-center"}),(0,s.jsxs)("div",{className:"flex w-full flex-col px-4 py-4",children:[(0,s.jsx)("span",{className:"font-bold",children:e&&e.productID&&e.productID.name}),(0,s.jsx)("span",{className:"font-semibold",children:e&&e.productID&&e.productID.price})]})]},e._id)):(0,s.jsx)("div",{children:"Your cart is empty"})})]}),(0,s.jsxs)("div",{className:"mt-10 bg-gray-50 px-4 pt-8 lg:mt-0",children:[(0,s.jsx)("p",{className:"text-xl font-medium",children:"Shipping address details"}),(0,s.jsx)("p",{className:"text-gray-400 font-bold",children:"Complete your order by selecting address below"}),(0,s.jsx)("div",{className:"w-full mt-6 mr-0 mb-0 ml-0 space-y-6",children:r&&r.length?r.map(e=>(0,s.jsxs)("div",{onClick:()=>(function(e){if(e._id===p){m(null),u({...d,shippingAddress:{}});return}m(e._id),u({...d,shippingAddress:{...d.shippingAddress,fullName:e.fullName,city:e.city,country:e.country,postalCode:e.postalCode,address:e.address}})})(e),className:"border p-6 ".concat(e._id===p?"border-red-900":""),children:[(0,s.jsxs)("p",{children:["Name : ",e.fullName]}),(0,s.jsxs)("p",{children:["Address : ",e.address]}),(0,s.jsxs)("p",{children:["City : ",e.city]}),(0,s.jsxs)("p",{children:["Country : ",e.country]}),(0,s.jsxs)("p",{children:["PostalCode : ",e.postalCode]}),(0,s.jsx)("button",{className:"mt-5 mr-5 inline-block bg-black text-white px-5 py-3 text-xs font-medium uppercase tracking-wide",children:e._id===p?"Selected Address":"Select Address"})]},e._id)):(0,s.jsx)("p",{children:"No addresses added"})}),(0,s.jsx)("button",{onClick:()=>y.push("/account"),className:"mt-5 mr-5 inline-block bg-black text-white px-5 py-3 text-xs font-medium uppercase tracking-wide",children:"Add new address"}),(0,s.jsxs)("div",{className:"mt-6 border-t border-b py-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Subtotal"}),(0,s.jsxs)("p",{className:"text-lg font-bold text-gray-900",children:["Rs",e&&e.length?e.reduce((e,t)=>t.productID.price+e,0):"0"]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Shipping"}),(0,s.jsx)("p",{className:"text-lg font-bold text-gray-900",children:"Free"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Total"}),(0,s.jsxs)("p",{className:"text-lg font-bold text-gray-900",children:["Rs",e&&e.length?e.reduce((e,t)=>t.productID.price+e,0):"0"]})]}),(0,s.jsx)("div",{className:"pb-10",children:(0,s.jsx)("button",{disabled:e&&0===e.length||0===Object.keys(d.shippingAddress).length,onClick:C,className:"disabled:opacity-50 mt-5 mr-5 w-full  inline-block bg-black text-white px-5 py-3 text-xs font-medium uppercase tracking-wide",children:"Checkout"})})]})]})]}),(0,s.jsx)(n.Z,{})]})}},6304:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var s=r(9268),n=r(474);function a(){return(0,s.jsx)(n.Ix,{position:"top-right",autoClose:4e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light",rtl:!1})}r(2657)},5579:function(e,t,r){"use strict";r.r(t),r.d(t,{GlobalContext:function(){return i},default:function(){return u},initialCheckoutFormData:function(){return c}});var s=r(9268),n=r(1712),a=r(6008),o=r(6006);let i=(0,o.createContext)(null),c={shippingAddress:{},paymentMethod:"",totalPrice:0,isPaid:!1,paidAt:new Date,isProcessing:!0},l=["cart","checkout","account","orders","admin-view"],d=["/admin-view","/admin-view/add-product","/admin-view/all-products"];function u(e){let{children:t}=e,[r,u]=(0,o.useState)(!1),[p,m]=(0,o.useState)(!0),[h,f]=(0,o.useState)({loading:!1,id:""}),[g,x]=(0,o.useState)(null),[y,j]=(0,o.useState)(null),[w,b]=(0,o.useState)(null),[v,S]=(0,o.useState)(!1),[N,k]=(0,o.useState)([]),[A,C]=(0,o.useState)([]),[I,O]=(0,o.useState)({fullName:"",city:"",country:"",postalCode:"",address:""}),[T,E]=(0,o.useState)(c),[P,_]=(0,o.useState)([]),[D,Z]=(0,o.useState)(null),[B,z]=(0,o.useState)([]),F=(0,a.useRouter)(),G=(0,a.usePathname)();return(0,o.useEffect)(()=>{if(void 0!==n.Z.get("token")){x(!0);let e=JSON.parse(localStorage.getItem("user"))||{},t=JSON.parse(localStorage.getItem("cartItems"))||[];j(e),k(t)}else x(!1),j({})},[n.Z]),(0,o.useEffect)(()=>{"/register"!==G&&!G.includes("product")&&"/"!==G&&y&&0===Object.keys(y).length&&l.includes(G)>-1&&F.push("/login")},[y,G]),(0,o.useEffect)(()=>{null!==y&&y&&Object.keys(y).length>0&&(null==y?void 0:y.role)!=="admin"&&d.indexOf(G)>-1&&F.push("/unauthorized-page")},[y,G]),(0,s.jsx)(i.Provider,{value:{showNavModal:r,setShowNavModal:u,pageLevelLoader:p,setPageLevelLoader:m,isAuthUser:g,setIsAuthUser:x,user:y,setUser:j,componentLevelLoader:h,setComponentLevelLoader:f,currentUpdatedProduct:w,setCurrentUpdatedProduct:b,showCartModal:v,setShowCartModal:S,cartItems:N,setCartItems:k,addresses:A,setAddresses:C,addressFormData:I,setAddressFormData:O,checkoutFormData:T,setCheckoutFormData:E,allOrdersForUser:P,setAllOrdersForUser:_,orderDetails:D,setOrderDetails:Z,allOrdersForAllUsers:B,setAllOrdersForAllUsers:z},children:t})}},9005:function(e,t,r){"use strict";r.d(t,{AF:function(){return n},_N:function(){return i},ar:function(){return a},y3:function(){return o}});var s=r(1712);let n=async e=>{try{let t=await fetch("/api/address/add-new-address",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s.Z.get("token"))},body:JSON.stringify(e)}),r=await t.json();return r}catch(e){console.log(e)}},a=async e=>{try{let t=await fetch("/api/address/get-all-address?id=".concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(s.Z.get("token"))}}),r=await t.json();return r}catch(e){console.log(e)}},o=async e=>{try{let t=await fetch("/api/address/update-address",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s.Z.get("token"))},body:JSON.stringify(e)}),r=await t.json();return r}catch(e){console.log(e)}},i=async e=>{try{let t=await fetch("/api/address/delete-address?id=".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(s.Z.get("token"))}}),r=await t.json();return r}catch(e){console.log(e)}}},8050:function(e,t,r){"use strict";r.d(t,{Bi:function(){return i},ax:function(){return a},mg:function(){return n},s$:function(){return o},wr:function(){return c}});var s=r(1712);let n=async e=>{try{let t=await fetch("/api/order/create-order",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s.Z.get("token"))},body:JSON.stringify(e)}),r=await t.json();return r}catch(e){console.log(e)}},a=async e=>{try{let t=await fetch("/api/order/get-all-orders?id=".concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(s.Z.get("token"))}}),r=await t.json();return r}catch(e){console.log(e)}},o=async e=>{try{let t=await fetch("/api/order/order-details?id=".concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(s.Z.get("token"))}}),r=await t.json();return r}catch(e){console.log(e)}},i=async()=>{try{let e=await fetch("/api/admin/orders/get-all-orders",{method:"GET",headers:{Authorization:"Bearer ".concat(s.Z.get("token"))}}),t=await e.json();return t}catch(e){console.log(e)}},c=async e=>{try{let t=await fetch("/api/admin/orders/update-order",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s.Z.get("token"))},body:JSON.stringify(e)}),r=await t.json();return r}catch(e){console.log(e)}}},2657:function(){}},function(e){e.O(0,[513,253,698,744],function(){return e(e.s=4014)}),_N_E=e.O()}]);